@page "/store/{id:int}"
@using System
@using System.Linq
@using System.Collections.Generic
@using Microsoft.AspNetCore.Components
@using Microsoft.AspNetCore.Components.Forms
@using ProjectPRN222.Models
@using ProjectPRN222.Services
@inject ProjectPRN222.Services.StoreService Svc
@inject NavigationManager Nav
@inject IJSRuntime JS
@implements IDisposable
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

@if (store is null)
{
    <p>Không tìm thấy.</p>
}
else
{
    <div class="card" style="margin-bottom:12px">
        <div class="card-head" style="display:flex; justify-content:space-between">
            <div style="display:flex; gap:10px; align-items:center">
                <strong>@store.storeName</strong>
                <span class="pill">#@store.id</span>
            </div>
            <div style="display:flex; gap:8px">
                <!-- Nút xem nhân viên -->
                <button type="button" class="btn btn-outline-primary" title="Xem nhân viên"
                        @* @onclick="() => Nav.NavigateTo($"/store/{id}/employees")"> *@>
                    <i class="bi bi-people"></i>
                </button>

                <!-- Nút sửa -->
                <button type="button" class="btn btn-outline-warning" title="Sửa" @onclick="StartEdit">
                    <i class="bi bi-pencil-square"></i>
                </button>

                <!-- Nút xóa -->
                <button type="button" class="btn btn-outline-danger" title="Xóa" @onclick="Delete">
                    <i class="bi bi-trash"></i>
                </button>
            </div>
        </div>

        <div class="card-body">
            <div class="grid" style="display:grid; grid-template-columns: 1fr 280px; gap:16px">
                <div>
                    <div style="display:grid; grid-template-columns:120px 1fr; gap:10px; align-items:center; margin-bottom:10px">
                        <img src="@store.bannerImageURL" class="banner" alt="Banner" />
                        <div style="display:grid; gap:6px">
                            <div><small class="pill">SellerId</small> <strong>@store.sellerId</strong></div>
                            <div><small class="pill">Mô tả</small> @store.description</div>
                            <div><small class="pill">Banner URL</small> <a href="@store.bannerImageURL" target="_blank" rel="noopener">@store.bannerImageURL</a></div>
                        </div>
                    </div>
                </div>
                <aside>
                    <div class="card">
                        <div class="card-head"><strong>Thao tác nhanh</strong></div>
                        <div class="card-body" style="display:flex; gap:8px; align-items:center">
                            <button type="button" class="btn btn-outline-secondary" @onclick="CopyId" title="Copy ID">
                                <i class="bi bi-clipboard"></i>
                            </button>

                            @if (!string.IsNullOrWhiteSpace(store.bannerImageURL))
                            {
                                <a class="btn btn-outline-info" href="@store.bannerImageURL" target="_blank" title="Mở banner">
                                    <i class="bi bi-image"></i>
                                </a>
                            }
                        </div>
                    </div>
                </aside>
            </div>
        </div>
    </div>
}

@if (editing && store is not null)
{
    <EditForm Model="editModel" OnValidSubmit="Save">
        <DataAnnotationsValidator />
        <div class="card">
            <div class="card-head"><strong>Sửa thông tin</strong></div>
            <div class="card-body" style="display:grid; gap:8px; max-width:640px">
                <div class="field">
                    <label>SellerId</label>
                    <InputNumber @bind-Value="editModel.sellerId" class="input" />
                </div>
                <div class="field">
                    <label>Tên cửa hàng</label>
                    <InputText @bind-Value="editModel.storeName" class="input" />
                    <ValidationMessage For="() => editModel.storeName" />
                </div>
                <div class="field">
                    <label>Mô tả</label>
                    <InputTextArea @bind-Value="editModel.description" class="input" />
                </div>
                <div class="field">
                    <label>BannerImageURL</label>
                    <InputText @bind-Value="editModel.bannerImageURL" class="input" />
                </div>
            </div>
            <div class="card-foot" style="display:flex; gap:8px; padding:8px">
                <button type="button" class="btn" @onclick="() => editing=false">Hủy</button>
                <button type="submit" class="btn primary">Lưu</button>
            </div>
        </div>
    </EditForm>
}


